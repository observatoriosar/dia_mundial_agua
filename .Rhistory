#-----------------------------------------------#
secas_PE$mapa2 <- as.Date.POSIXct(secas_PE$Mapa)
secas_PE$mapa2
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_date(breaks = secas_PE$Mapa) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_date(breaks = secas_PE$Mapa) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_discrete(breaks = secas_PE$Mapa) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
#-----------------------------------------------#
# SECA
#-----------------------------------------------#
secas_PE$mapa2 <- as.character(as.Date(secas_PE$Mapa))
secas_PE$mapa2
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_date(breaks = secas_PE$mapa2) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_date(breaks = secas_PE$mapa2) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
#  scale_x_date(breaks = secas_PE$mapa2) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
#  geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_date(breaks = secas_PE$mapa2) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
#  scale_x_date(breaks = secas_PE$mapa2) +
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
secas_PE$mapa2
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
#  scale_x_date(breaks = secas_PE$mapa2) +
scale_x_date(date_labels="%b %y",date_breaks  ="1 month")+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()%replace%
theme(axis.text.x = element_text(angle = 90))
library(dplyr)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()%replace%
theme(axis.text.x = element_text(angle = 90))
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 90))
secas_PE$mapa2
library(stringr)
str_replace(secas_PE$mapa2, "-01", "")
ssecas_PE$mapa2 <- tr_replace(secas_PE$mapa2, "-01", "")
ssecas_PE$mapa2 <- str_replace(secas_PE$mapa2, "-01", "")
secas_PE$mapa2 <- str_replace(secas_PE$mapa2, "-01", "")
library(dplyr)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))
ggsave("seca_S3S4.png", path = "resultados",width = 14, height = 6, units = "in" )
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=-68, ymax = -90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_discrete(breaks = secas_PE$mapa2)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90, xmin = )
ggplot(data = secas_PE, aes(x = secas_PE$Mapa, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
secas_PE$mapa3 <- c(1:length(secas_PE$mapa2))
secas_PE$mapa3
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
secas_PE$mapa3 <- c(1:length(secas_PE$mapa2))
View(secas_PE)
:?
?:
order(c(1:length(secas_PE$mapa2)), decreasing = T)
secas_PE$mapa3 <-  order(c(1:length(secas_PE$mapa2)), decreasing = T)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_discrete(breaks = secas_PE$mapa2)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_continuous(breaks = secas_PE$mapa2)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_continuous(breaks = secas_PE$Mapa)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa3, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_x_date(breaks = secas_PE$Mapa)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))+
annotation_custom(osar, ymin=68, ymax = 90)
library(dplyr)
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(x = "Nível de Seca S3-S4", y = "", title = "Nível de Seca em PE")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))
ggsave("seca_S3S4.png", path = "resultados",width = 12, height = 5, units = "in" )
ggplot(data = secas_PE, aes(x = secas_PE$mapa2, y = secas_PE$`S3-S4`, group =1))+
geom_line(color = "#990000")+
geom_area(fill = "#990000") +
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(y = "Nível de Seca", x = "", title = "Nível de Seca em PE (S3-S4)")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))
ggsave("seca_S3S4.png", path = "resultados",width = 12, height = 5, units = "in" )
ggsave("seca_S3S4.png", path = "resultados",width = 9, height = 3, units = "in" )
ggsave("seca_S3S4.png", path = "resultados",width = 10, height = 4, units = "in" )
snis_PE_ano <- aggregate(snis_data$`IN049 - Índice de perdas na distribuição`,
by = list(snis_data$`Ano de Referência`),
mean)
View(snis_PE_ano)
snis_data = snis_data[complete.cases(snis_data$`IN049 - Índice de perdas na distribuição`),]
View(snis_data)
snis_PE_ano <- aggregate(snis_data$`IN049 - Índice de perdas na distribuição`,
by = list(snis_data$`Ano de Referência`),
mean)
snis_PE_ano
snis_PE_ano$indice_perdas_distribuicao <- round(snis_PE_ano$x, 2)
snis_PE_ano$indice_perdas_distribuicao
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$Group.1, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#990000")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
labs(y = "Nível de Seca", x = "", title = "Nível de Seca em PE (S3-S4)")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$Group.1, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()+
theme(axis.text.x = element_text(angle = 60))
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$Group.1, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
scale_x_discrete(breaks = snis_PE_ano$Group.1)+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()
View(snis_PE_ano)
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$Group.1, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$Group.1, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$Group.1, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()
snis_PE_ano$ano <- as.character(snis_PE_ano$Group.1)
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$ano, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$ano, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE ()")+
tema_massa()+
theme(axis.text.x = element_text(angle = 50))
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$ano, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
geom_text_repel(aes(label = snis_PE_ano$indice_perdas_distribuicao))+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE (1998-2017)")+
tema_massa()+
theme(axis.text.x = element_text(angle = 50))
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$ano, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
geom_text_repel(aes(label = snis_PE_ano$indice_perdas_distribuicao), size = 2)+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE (1998-2017)")+
tema_massa()+
theme(axis.text.x = element_text(angle = 50))
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$ano, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
geom_text_repel(aes(label = snis_PE_ano$indice_perdas_distribuicao), size = 3)+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE (1998-2017)")+
tema_massa()+
theme(axis.text.x = element_text(angle = 50))
ggsave("perdasPE.png", path = "resultados",width = 10, height = 4, units = "in" )
ggsave("perdasPE.png", path = "resultados",width = 9, height = 4, units = "in" )
snis_data = snis_data[snis_data$`Ano de Referência` >= 2000,]
#-------------------------------------------#
# Observatorio de Saneamento
# e Meio Ambiente do Recife OSAR
#------------------------------------------#
# importar pacotes
library(readxl); library(png); library(grid); library(ggplot2)
library(stringr); library(viridis); library(maps); library(raster);
library(ggrepel);  library(sp); library(maps); library(maptools); library(xlsx)
library(dplyr); library(stringi)
if (!require(gpclib)) install.packages("gpclib", type="source")
library(gpclib)
library(rgdal)
library(maptools)
gpclibPermit()
# importar dados
snis_data <- read_excel("dados/snis_data.xls")
code_muni <- read.csv("dados/code_muni1e2.csv")
secas_PE <- read_excel("dados/secas_PE.xlsx")
shape_pe <- shapefile("pe_municipios/26MUE250GC_SIR.shp")
shape_pe <- shapefile(file.choose())
# importar objetos e metodos de uso geral
source("codigos/metodos_propriedades_gerais.R")
# importar imagem osar
osar <- readPNG("docs_imagens/osar_fundo-transparente.png")
osar <- rasterGrob(osar, interpolate=TRUE)
#---------------------- select
snis_data17 <- snis_data[snis_data$`Ano de Referência` == 2017,]
snis_data17 = snis_data17[complete.cases(snis_data17$`IN049 - Índice de perdas na distribuição`),]
snis_data = snis_data[complete.cases(snis_data$`IN049 - Índice de perdas na distribuição`),]
snis_data = snis_data[snis_data$`Ano de Referência` >= 2000,]
# merge code_muni com snis_data17
colnames(snis_data17)[1] <- "code_muni"
snis_data17 <- merge(snis_data17, code_muni[,c(2,3,8)], by="code_muni")
#-------------------------------------------------#
# pernambuco em comparacao com os demais estados
#-------------------------------------------------#
# grafico de barra media ultimos 10 anos
# grafico de barra media no ano mais recente
# grafico de linha PE / BA / CE
snis_PE_ano <- aggregate(snis_data$`IN049 - Índice de perdas na distribuição`,
by = list(snis_data$`Ano de Referência`),
mean)
snis_PE_ano$indice_perdas_distribuicao <- round(snis_PE_ano$x, 2)
snis_PE_ano$ano <- as.character(snis_PE_ano$Group.1)
ggplot(data = snis_PE_ano, aes(x = snis_PE_ano$ano, y = snis_PE_ano$indice_perdas_distribuicao, group =1))+
geom_line(color = "#008989")+
stat_smooth(method = lm, color= "#E69F00", se = F)+
geom_text_repel(aes(label = snis_PE_ano$indice_perdas_distribuicao), size = 3)+
scale_y_continuous(limits = c(0, 100))+
#  scale_x_discrete(breaks = c(1998:2017))+
labs(y = "% de Perdas", x = "", title = "Perdas de Água no Abastecimento em PE (1998-2017)")+
tema_massa()+
theme(axis.text.x = element_text(angle = 50))
ggsave("perdasPE.png", path = "resultados",width = 9, height = 4, units = "in" )
# mergir bases
colnames(shape_pe@data)[2] <- "code_muni2"
shp_data <- merge(shape_pe, snis_data17, by = "code_muni2")
# ordenar
shp_data <- shp_data[order(shp_data$`IN049 - Índice de perdas na distribuição`),]
# tranformar shapefile em polygonsdataframe
data_fortity = fortify(shp_data, region = "NM_MUNICIP")
# extrair centroides dos poligonos
centroids.df = as.data.frame(coordinates(shp_data))
names(centroids.df) = c("Longitude", "Latitude")  #more sensible column localidades
# base para plotagem
localidade = shp_data@data$NM_MUNICIP
Freq = shp_data@data$`IN049 - Índice de perdas na distribuição`
map_dataframe = data.frame(localidade, Freq, centroids.df, nomes_centroides = "")
map_dataframe$nomes_centroides = as.character(map_dataframe$nomes_centroides)
map_dataframe$localidade = as.character(map_dataframe$localidade)
map_dataframe$nomes_centroides[174:179] = map_dataframe$localidade[174:179]
#---- mapa ----#
library(ggrepel)
library(viridis)
ggplot(data = map_dataframe, aes(map_id = localidade)) +
geom_map(aes(fill = shp_data$`IN049 - Índice de perdas na distribuição`), size = 0.2, colour = grey(0.85),  map = data_fortity) +
expand_limits(x = data_fortity$long, y = data_fortity$lat) +
scale_fill_viridis(name = "Perdas de Água no Sistema\n de Abastecimento em PE (%)", option= "D")+
#scale_fill_gradient(name = "Número de Projetos", low="lightgreen", high= "darkblue")+
#geom_label_repel(aes(label = nomes_centroides, x = Longitude, y = Latitude), size = 3, color = "black") +
labs(title = "")+
coord_fixed(1) +
theme_minimal()%+replace%
theme(legend.direction = "horizontal",
legend.position=c(0.5, 0.6),
axis.line=element_blank(),axis.text.x=element_blank(),
axis.text.y=element_blank(),axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank()
)+annotation_custom(osar, ymin=-10, ymax = -8, xmin = -33.5, xmax = -32)
ggsave("mapa_PE.png", path = "resultados",width = 14, height = 6, units = "in" )
shape_pe <- shapefile("pe_municipios/26MUE250GC_SIR.shp")
# importar dados
library(raster)
shape_pe <- shapefile("pe_municipios/26MUE250GC_SIR.shp")
shape_pe <- shapefile(file.choose())
shape_pe <- shapefile(file.choose())
snis_data <- read_excel("dados/snis_data.xls")
# importar pacotes
library(raster); library(readxl)
# importar dados
shape_pe <- shapefile("pe_municipios/26MUE250GC_SIR.shp")
snis_data <- read_excel("dados/snis_data.xls")
# selecionar dados de 2017 e retirar casos faltantes
snis_data17 <- snis_data[snis_data$`Ano de Referência` == 2017,]
snis_data17 = snis_data17[complete.cases(snis_data17$`IN049 - Índice de perdas na distribuição`),]
# combinar bases
colnames(shape_pe@data)[2] <- "code_muni2"
shp_data <- merge(shape_pe, snis_data17, by = "code_muni2")
# combinar bases com codigo do municipio
colnames(snis_data17)[1] <- "code_muni"
snis_data17 <- merge(snis_data17, code_muni[,c(2,3,8)], by="code_muni")
code_muni <- read.csv("dados/code_muni1e2.csv")
# selecionar dados de 2017 e retirar casos faltantes
snis_data17 <- snis_data[snis_data$`Ano de Referência` == 2017,]
snis_data17 = snis_data17[complete.cases(snis_data17$`IN049 - Índice de perdas na distribuição`),]
# combinar bases com codigo do municipio
colnames(snis_data17)[1] <- "code_muni"
snis_data17 <- merge(snis_data17, code_muni[,c(2,3,8)], by="code_muni")
# combinar dados perdas de agua com poligonos
colnames(shape_pe@data)[2] <- "code_muni2"
shp_data <- merge(shape_pe, snis_data17, by = "code_muni2")
